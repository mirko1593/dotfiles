"--------------------Basic--------------------
set nocompatible
filetype indent on


set backspace=indent,eol,start
set noeb vb t_vb=
syntax on
set hidden
set complete=.,w,b,u
set completeopt-=preview
set cpoptions+=d
set tags+=./tags.laravel                    " set "./" relative to current directory, not current file
set autoread                                " automatically read updated file to buffer
"set shellcmdflag+=i
set directory=$HOME/.vim/swapfiles//        " put swapfile to a specific directory

let mapleader = ","

set relativenumber
set ruler
set laststatus=2
set scrolloff=2

set history=50
set showcmd

" neckbeard
let ruby_space_errors = 1
let c_space_errors = 1



""" Search Config
set incsearch
set hlsearch
set ignorecase                              "case insensitive pattern matching
set smartcase                               "overrides ignorecase if pattern contains upcase


""" Split
set splitbelow
set splitright

nnoremap <C-J> <C-w><C-J>
nnoremap <C-K> <C-W><C-K>
nnoremap <C-H> <C-W><C-H>
nnoremap <C-L> <C-W><C-L>

nnoremap <C-\> :wincmd <Bar><cr>
nnoremap <C-_> :wincmd =<cr>
nnoremap <C-O> :wincmd o<cr>




"--------------------Visual--------------------
set background=light
colorscheme base16-tomorrow
set t_CO=256
set linespace=14
set numberwidth=2
set guifont=Operator_Mono_XLight:h14

set guioptions-=l
set guioptions-=L
set guioptions-=r
set guioptions-=R

hi vertsplit guifg=bg guibg=bg



"--------------------Indentation--------------------
"""
""" Only when (noexpandtab) && (!shiftwidth || !softtabstop),
""" tabstop is used to convert "#spaces" to a tab
set autoindent
set expandtab
set tabstop=4               "basic tab size
set shiftwidth=4            "shift width in normal mode
set softtabstop=4           "tab size in insert mode




"--------------------BasicMapping--------------------
nmap <leader>ev :tabedit $MYVIMRC<cr>
nmap <leader>ep :split ~/.vim/plugins.vim<cr>

nmap <leader><space> :nohlsearch<cr>

nmap <leader>f :tag<space>
" ctags will read config file ~/.ctags
nmap <leader>rt :!ctags -Rftags<cr>
" generate tags for laravel source code
nmap <leader>lt :!ctags -R -f tags.laravel vendor/laravel<cr>

"edit file in current director
nmap <leader>e :e <C-R>=escape(expand("%:p:h"), ' ') . '/'<CR>      



"--------------------AutoCommands--------------------
autocmd FileType help nmap q :q<cr>
augroup basic
    autocmd!
    autocmd BufWritePost .vimrc so %
    autocmd BufWritePost ~/.vim/plugins.vim so $MYVIMRC
augroup END


augroup autoindent
    autocmd!
    autocmd FileType ruby,eruby setlocal ts=2 sts=2 sw=2 expandtab
    autocmd FileType javascript setlocal ts=2 sts=2 sw=2 expandtab
augroup END


augroup surround
    autocmd!
    autocmd FileType php let b:surround_45 = "<?php \r ?>"
    autocmd FileType php let b:surround_61 = "<?= \r ?>"
    autocmd FileType blade let b:surround_61 = "{{ \r }}"
    autocmd FileType ruby let g:surround_45 = "<% \r %>"
    autocmd FileType ruby let g:surround_61 = "<%= \r %>"
augroup END

augroup commentary
    autocmd!
    autocmd FileType php setlocal commentstring=#\ %s
    autocmd FileType blade setlocal commentstring={{--\ %s\ --}}
augroup END
"--------------------Plugins--------------------


""" Airline
let g:airline_theme='base16'


""" Bufferline
"denotes whether bufferline should automatically echo to the command bar
let g:bufferline_echo = 0
"scrolling with fixed current buffer position
let g:bufferline_rotate = 1
"current buffer always first
let g:bufferline_fixed_index = 0



""" Vinegar
"Press . on a file to pre-populate it at the end of a : command line
"Press ! on a file starts the line off with a bang
"Press d to create a new directory
"Press % to create a new file
"press D to delete current item
"press R to rename current item



""" NERDTreeToggle
nmap <D-1> :NERDTreeToggle<cr>

let NERDTreeHijackNetrw = 0
let NERDTreeShowHidden = 1

"open NERDTree automatically when vim starts with no 
"arguments. eg: "vim" or "vim ."
autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * if argc() == 0 && !exists("s:std_in") | NERDTree | endif





""" CtrlP
" When invoked:
" <c-d> - switch to filename search instead of full-path search
"         default is full-path search
" <c-r> - switch to regexp mode
" F5    - refresh
nmap <D-p> :CtrlP<cr>
nmap <D-r> :CtrlPBufTag<cr>
nmap <D-e> :CtrlPMRUFiles<cr>

let g:ctrlp_match_window = 'bottom,order:btt,min:1,max:10,results:10'
" When invoked without an explicit starting directory,
" CtrlP will set its local working directory according
" to this variable
" c - the directory of the current file
" a - the directory of the current file, unless it is a
"     subdirectory of the cwd
" r - the nearest ancestor of the current file that contains
"     one of these files or dirs specified in marker variable.
" w - modifier to 'r': start search from cwd instead of the
"     current file's directory
" 0 or '' - disable this feature
let g:ctrlp_working_path_mode = 'ra'
let g:ctrlp_root_markers = ['vendor', 'node_modules', '.git']

"let CtrlP use ag for listing files. Way faster and no useless files
"with --hidden, it can find files start with .
let g:ctrlp_user_command = 'ag %s -l --hidden --nocolor -g ""'
let g:ctrlp_use_caching = 0

" \v means "very magic",  \V means "no magic"
let g:ctrlp_custom_ignore = {
  \ 'dir':  '\v[\/]\.(git|hg|svn|node_modules)$',
  \ 'file': '\v\.[(exe|so|dll)|(DS_Store)]$',
  \ 'link': 'some_bad_symbolic_links',
  \ }


""" Ag
let g:ag_prg="ag --vimgrep --line-numbers --noheading"
let g:ag_working_path_mode="r"
" Usage: 
" :Ag [options] {pattern} [{directory}]
"
" Shortcuts:
" e    to open file and close the quickfix window
" o    to open (same as enter)
" go   to preview file (open but maintain focus on ag.vim results)
" t    to open in new tab
" T    to open in new tab silently
" h    to open in horizontal split
" H    to open in horizontal split silently
" v    to open in vertical split
" gv   to open in vertical split silently
" q    to close the quickfix window




""" Greplace
set grepprg=ag\ --ignore\ *tags*
let g:grep_cmd_opts = '--line-numbers --ignore vendor --ignore node_modules --noheading'
" Usage:
" 1> use :Gsearch to get a buffer window of search results
" 2> make replacement in buffer window using traditional tool: s/foo/bar
" 3> invoke :Greplace to make changes across all files.
" 4> save changes to all files :wa




""" PDV - PHP Documentor for Vim
let g:pdv_template_dir = $HOME ."/.vim/bundle/pdv/templates_snip"
nnoremap <leader>d :call pdv#DocumentWithSnip()<CR>



""" UltiSnips
let g:UltiSnipsSnippetsDir=$HOME."/.vim/UltiSnips"
"let g:UltiSnipsSnippetDirectories=["UltiSnips"]
let g:UltiSnipsExpandTrigger="<tab>"
let g:UltiSnipsJumpForwardTrigger="<tab>"
let g:UltiSnipsJumpBackwardTrigger="<s-tab>"



""" php-namespaces

function! IPhpInsertUse()
    call PhpInsertUse()
    call feedkeys('a',  'n')
endfunction
autocmd FileType php inoremap <Leader>n <Esc>:call IPhpInsertUse()<CR>
autocmd FileType php noremap <Leader>n :call PhpInsertUse()<CR>

function! IPhpExpandClass()
    call PhpExpandClass()
    call feedkeys('a', 'n')
endfunction
autocmd FileType php inoremap <Leader>nf <Esc>:call IPhpExpandClass()<CR>
autocmd FileType php noremap <Leader>nf :call PhpExpandClass()<CR>

" autocmd FileType php inoremap <Leader>s <Esc>:call PhpSortUse()<CR>
" autocmd FileType php noremap <Leader>s :call PhpSortUse()<CR>

" let g:php_namespace_sort_after_insert = 1

vmap <leader>su ! awk '{ print length(), $0 \| "sort -n \| cut -d\\  -f2-" }'<cr>



"" autotag
let g:autotagTagsFile="tags"
let g:autotagCtagsCmd="ctags -Rftags"


""" php-cs-fixer
nnoremap <silent><leader>rf :call PhpCsFixerFixFile()<CR>
" nnoremap <silent><leader>pcd :call PhpCsFixerFixDirectory()<CR>
let g:php_cs_fixer_rules = "@PSR2"




""" syntastic
set statusline+=%#warningmsg#
set statusline+=%{SyntasticStatuslineFlag()}
set statusline+=%*

let g:syntastic_always_populate_loc_list = 1
let g:syntastic_auto_loc_list = 1
let g:syntastic_check_on_open = 1
let g:syntastic_check_on_wq = 0
"let g:syntastic_php_checkers = ["php", "phpcs", "phpmd"]
let g:syntastic_php_checkers = ["php", "phpmd"]


let g:fzf_launcher = "~/.vim/fzf_MacVim %s"



"--------------------Concepts--------------------
"""Tags
" A tag is an identifier that appears in a "tag" file
" which has to be generated by a program like ctags.
"
" On the tag stack is remembered which tags you jumped to,
" and from where.
"
"
" 1> Operations on Tag Stack:
" :tags - Show the content of the tag stack, the active entry
"         is marked with a '>'
" Ctrl-T : Same to [1]pop
" :[count]pop - Jump to [count] older/up entry in tag stack
" :[count]tag - Jump to [count] newer/down entry in tag stack
" ps: pop/tag will not "truely" pop the "tag stack"
"
"
" 2> Operations on "tags" file:
" Ctrl-] : same to ":tag {ident}"
" :tag {ident} - Jump to the definition of {ident}, and put
"               {ident} in the tag stack"
" ps: so an easy way back if "Ctrl-T", which is jump back 
"     to older entry in "tag stack"
"
"
" 3> Operations on matching-list:
" :ts [ident]  -   List tags match [ident], using infomation 
"                  in the tags file.
"                  When [ident] is not given, the last tag name 
"                  from tag stack is used.
" :sts [ident] -   Does ":ts [ident]" and splits the window for 
"                  the selected tag
" g]           -   Like "Ctrl-]", but use ":ts" instead of ":tag"
"                  ie: use "matching-list"
" :tj [ident]  -   Like ":ts", but jump to the tag directly when 
"              -   there is only one match.
" :sts [ident] -   Does ":tj" and splits the window for selected tag
" g Ctrl-]     -   Like "Ctrl-]", but use ":tj" instead of ":tag"
" [count]tn, tN, tp, tr/tf, tl
" 
" The tag match list can also be used in the preview window. The 
" commands are the same as above, with a "p" prepended.
" pts, ptj, ptn, ptN, ptp, ptr, ptf
"
" Key-mapping provided by "tpope/un-impaired"
nnoremap <silent> ]t :tn<cr>
nnoremap <silent> [t :tp<cr>
nnoremap <silent> ]T :tl<cr>
nnoremap <silent> [T :tf<cr>



so ~/.vim/plugins.vim
